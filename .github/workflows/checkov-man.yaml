name: 'checkov man'
on:
  workflow_dispatch:
env:
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }} # An automatically generated secret provided by GitHub for use in GitHub Actions.
jobs:
  terraform-fmt-validate:
    name: 'Terraform FMT & Validate'
    runs-on: ubuntu-latest
    steps:
    - name: Checkout the repository
      uses: actions/checkout@v3
      with:
        ref: main
    - name: Install jq
      run: |
        sudo apt-get update
        sudo apt-get install jq -y
    - name: Use jq
      run: |
        # Example: Print the version of jq
        jq --version
    - name: Setup Terraform on the runner
      uses: hashicorp/setup-terraform@v2.0.3
    - name: Terraform init, fmt, & validate - module
      run: |
        cd example
        terraform init -backend=false
        terraform plan --out tfplan.binary
        terraform show -json tfplan.binary | jq > tfplan.json
        checkov -f tfplan.json
